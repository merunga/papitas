"use strict";var isMoving,BootS,PreloaderS,MainMenuS,PlayS,CreditsS,LeaderBoardsS,game,WebFontConfig;WebFontConfig={google:{families:["Source+Code+Pro::latin"]}},function(){var a=document.createElement("script");a.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",a.type="text/javascript",a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),window.onload=function(){isMoving=!1,game=new Phaser.Game(200,275,Phaser.AUTO,"rompecabezas-container"),game.state.add("boot",BootS),game.state.add("preloader",PreloaderS),game.state.add("credits",CreditsS),game.state.add("leaderboards",LeaderBoardsS),game.state.add("mainmenu",MainMenuS),game.state.add("play",PlayS),game.state.start("boot")},Array.prototype.equals=function(a){if(!a)return!1;if(this.length!=a.length)return!1;for(var b=0,c=this.length;c>b;b++)if(this[b]instanceof Array&&a[b]instanceof Array){if(!this[b].compare(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0};var NumberBlock=function(a,b,c){console.log("Inicia NumberBlock"),this.number=c,this.position=0,this.position0=1,Phaser.Sprite.call(this,game,a,b,"block"),this.txt=game.add.text(a+20,b+20,c,{font:"20px Source Code Pro",fill:"#F0F0F0",align:"center"})};NumberBlock.prototype=Object.create(Phaser.Sprite.prototype),NumberBlock.prototype.constructor=NumberBlock,NumberBlock.prototype.update=function(){this.txt.x=this.x+20,this.txt.y=this.y+20},NumberBlock.prototype.move=function(a){var b=game.add.tween(this),c=game.add.tween(this.txt);switch(b.onStart.add(function(){isMoving=!0}),b.onComplete.add(function(){isMoving=!1}),a){case"left":b.to({x:this.x-50},250,Phaser.Easing.Linear.None,!1,0,0,!1),c.to({x:this.txt.x-50},250,null),c.start(),b.start();break;case"up":b.to({y:this.y-50},250,Phaser.Easing.Linear.None,!1,0,0,!1),c.to({y:this.txt.y-50},250,null),c.start(),b.start();break;case"right":b.to({x:this.x+50},250,Phaser.Easing.Linear.None,!1,0,0,!1),c.to({x:this.txt.x+50},250,null),c.start(),b.start();break;case"down":b.to({y:this.y+50},250,Phaser.Easing.Linear.None,!1,0,0,!1),c.to({y:this.txt.y+50},250,null),c.start(),b.start()}},NumberBlock.prototype.onDown=function(){if(console.log(this.parent.arrNumbs),this.position=this.parent.checkPosition(this.number),this.position0=this.parent.checkPosition(0),this.position-this.position0!==0)switch(this.position){case 0:switch(this.position0){case 1:this.move(3);break;case 3:this.move(2);break;default:return}break;case 1:switch(this.position0){case 0:this.move(1);break;case 2:this.move(3);break;case 4:this.move(4);break;default:return}break;case 2:switch(this.position0){case 1:this.move(1);break;case 5:this.move(4);break;default:return}break;case 3:switch(this.position0){case 0:this.move(2);break;case 4:this.move(3);break;case 6:this.move(4);break;default:return}break;case 4:break;case 5:break;case 6:break;case 7:break;case 8:}console.log("Numbs: "+this.parent.arrNumbs),console.log(this.parent.arrNumbs)};var Board=function(a){Phaser.Group.call(this,game),this.h=0,this.isFinal=!1,this.isSolvable=!1,this.moves=0,this.totalCost=0,this.position0=0,a?this.arrNumbs=a:a=[]};Board.prototype=Object.create(Phaser.Group.prototype),Board.prototype.constructor=Board,Board.prototype.genFinal=function(){this.moves=0,this.arrNumbs=[1,2,3,4,5,6,7,8,0]},Board.prototype.genRandom=function(){this.arrNumbs=[],this.moves=0,this.clearBoard();var a=[1,2,3,4,5,6,7,8,0];this.arrNumbs=Phaser.Utils.shuffle(a),this.checkSolvable(this.arrNumbs)?(this.isSolvable=!0,this.logBoard()):this.genRandom()},Board.prototype.genTest=function(){this.arrNumbs=[],this.moves=0,this.clearBoard(),this.arrNumbs=[1,2,3,4,5,6,0,7,8],console.log("Solvable: "+this.checkSolvable(this.arrNumbs)),this.logBoard()},Board.prototype.checkSolvable=function(a){var b=0,c=0,d=0;for(c=a.length-1;c>=0;c--)for(d=c-1;d>=0;d--)a[d]>a[c]&&0!==a[c]&&0!==a[d]&&b++;return b%2===0?(console.log("Solvable - "+a+" - "+b),!0):(console.log("Unsulvable - "+a+" - "+b),!1)},Board.prototype.equals=function(a){if(!a)return!1;if(!a.arrNumbs)return!1;if(this.arrNumbs.length!==a.arrNumbs.length)return!1;var b=0;for(b=this.arrNumbs.length-1;b>=0;b--)if(this.arrNumbs[b]!=a.arrNumbs[b])return!1;return!0},Board.prototype.logBoard=function(){console.log("Board: "+this.arrNumbs)},Board.prototype.checkPosition=function(a){var b=0;for(b=this.arrNumbs.length-1;b>=0;b--)if(this.arrNumbs[b]===a)return b},Board.prototype.draw=function(){this.clearBoard(this);var a=0,b=0,c=0,d={};for(b=3;b>0;b--)for(c=3;c>0;c--)0!==this.arrNumbs[a]&&(d=new NumberBlock(-50*(c-3)+25,-50*(b-3)+50,this.arrNumbs[a],this),this.add(d)),a++},Board.prototype.clearBoard=function(){this.forEach(this.clearTxt,this,!0),this.removeAll()},Board.prototype.calcHueristic=function(){var a=0,b=0;for(b=this.arrNumbs.length-1;b>=0;b--)0!==this.arrNumbs[b]&&(a+=Math.abs(b-(this.arrNumbs[b]-1)));this.h=a},Board.prototype.calcTotalCost=function(){this.totalCost=this.moves+this.h},Board.prototype.clearTxt=function(a){a.txt.destroy()},Board.prototype.move=function(a){if(isMoving)return!1;isMoving=!0,this.position0=this.checkPosition(0);var b={};if("up"===a){if(this.position0>=6&&this.position0<=8)return isMoving=!1,!1;b=this.getAt(this.position0+2),b.move(a),this.remove(b),this.addAt(b,this.position0),this.arrNumbs[this.position0]=this.arrNumbs[this.position0+3],this.arrNumbs[this.position0+3]=0}else if("down"==a){if(this.position0>=0&&this.position0<=2)return isMoving=!1,!1;b=this.getAt(this.position0-3),b.move(a),this.remove(b),this.addAt(b,this.position0-1),this.arrNumbs[this.position0]=this.arrNumbs[this.position0-3],this.arrNumbs[this.position0-3]=0}else if("right"==a){if(0===this.position0||3===this.position0||6===this.position0)return isMoving=!1,!1;b=this.getAt(this.position0-1),b.move(a),this.remove(b),this.addAt(b,this.position0-1),this.arrNumbs[this.position0]=this.arrNumbs[this.position0-1],this.arrNumbs[this.position0-1]=0}else if("left"==a){if(2===this.position0||5===this.position0||8===this.position0)return isMoving=!1,!1;b=this.getAt(this.position0),b.move(a),this.remove(b),this.addAt(b,this.position0),this.arrNumbs[this.position0]=this.arrNumbs[this.position0+1],this.arrNumbs[this.position0+1]=0}isMoving=!1,this.moves++;var c=[1,2,3,4,5,6,7,8,0];this.arrNumbs.equals(c)&&(this.isFinal=!0),this.logBoard()};var Solver=function(a,b){this.open=[],this.close=[],this.moves=0,this.boardI=a,this.boardF=b,this.open.push(Phaser.Utils.extend(!0,{},a))};Solver.prototype.solve=function(){for(var a=0;!this.open[this.open.length-1].equals(this.boardF)&&this.open.length>0;){var b=this.open.pop(),c=0;switch(this.close.push(Phaser.Utils.extend(!0,{},b)),c=b.checkPosition(0)){case 0:this.swap(b,3,c),this.swap(b,4,c);break;case 1:this.swap(b,1,c),this.swap(b,3,c),this.swap(b,4,c);break;case 2:this.swap(b,1,c),this.swap(b,4,c);break;case 3:this.swap(b,2,c),this.swap(b,3,c),this.swap(b,4,c);break;case 4:this.swap(b,1,c),this.swap(b,2,c),this.swap(b,3,c),this.swap(b,4,c);break;case 5:this.swap(b,1,c),this.swap(b,2,c),this.swap(b,4,c);break;case 6:this.swap(b,2,c),this.swap(b,3,c);break;case 7:this.swap(b,1,c),this.swap(b,2,c),this.swap(b,3,c);break;case 8:this.swap(b,1,c),this.swap(b,2,c)}this.open.sort(this.compare),0!==this.open.length&&(this.boardI.arrNumbs=this.open[this.open.length-1].arrNumbs,a++,console.log("solving - count: "+a+" - board: "+this.open[0].arrNumbs+" - closed-size: "+this.close.length+" - position: "+c))}this.boardI.draw(),console.log("Solved: "+this.open[this.open.length-1].arrNumbs)},Solver.prototype.swap=function(a,b,c){this.position=c;var d=Phaser.Utils.extend(!0,{},a),e=[];switch(b){case 1:d.arrNumbs[this.position]=d.arrNumbs[this.position-1],d.arrNumbs[this.position-1]=0;break;case 2:switch(this.position){case 3:d.arrNumbs[3]=d.arrNumbs[0],d.arrNumbs[0]=0;break;case 4:d.arrNumbs[4]=d.arrNumbs[1],d.arrNumbs[1]=0;break;case 5:d.arrNumbs[5]=d.arrNumbs[2],d.arrNumbs[2]=0;break;case 6:d.arrNumbs[6]=d.arrNumbs[3],d.arrNumbs[3]=0;break;case 7:d.arrNumbs[7]=d.arrNumbs[4],d.arrNumbs[4]=0;break;case 8:d.arrNumbs[8]=d.arrNumbs[5],d.arrNumbs[5]=0}break;case 3:d.arrNumbs[this.position]=d.arrNumbs[this.position+1],d.arrNumbs[this.position+1]=0;break;case 4:switch(this.position){case 0:d.arrNumbs[0]=d.arrNumbs[3],d.arrNumbs[3]=0;break;case 1:d.arrNumbs[1]=d.arrNumbs[4],d.arrNumbs[4]=0;break;case 2:d.arrNumbs[2]=d.arrNumbs[5],d.arrNumbs[5]=0;break;case 3:d.arrNumbs[3]=d.arrNumbs[6],d.arrNumbs[6]=0;break;case 4:d.arrNumbs[4]=d.arrNumbs[7],d.arrNumbs[7]=0;break;case 5:d.arrNumbs[5]=d.arrNumbs[8],d.arrNumbs[8]=0}}e=d.arrNumbs,d=new Board(e,a),d.moves=a.moves+1,d.calcHueristic(),d.calcTotalCost(),this.checkClosed(d)||this.open.push(d)},Solver.prototype.checkClosed=function(a){var b=0;for(b=this.close.length-1;b>=0;b--)if(this.close[b].equals(a))return!0;return!1},Solver.prototype.compare=function(a,b){return a.totalCost>b.totalCost?-1:a.totalCost<b.totalCost?1:0},function(){function a(){}a.prototype={preload:function(){this.load.image("loadingBG","assets/res/img/LoadingBG.png"),this.load.image("loading","assets/res/img/Loading.png"),this.load.image("frame","assets/res/textures/frame.png")},create:function(){game.input.maxPointers=1,game.state.start("preloader")}},BootS=a}(),function(){function a(){this.preloadBarBg=null,this.preloadBar=null}a.prototype={preload:function(){game.stage.backgroundColor="#FFF",this.preloadBarBg=this.add.sprite(300,400,"loadingBG"),this.preloadBar=this.add.sprite(304,405,"loading"),this.load.image("block","assets/res/img/block.png"),this.load.atlasJSONHash("btts","assets/res/spritesheets/btts_small.png","assets/res/spritesheets/btts_small.json"),game.add.sprite(0,0,"frame"),this.load.setPreloadSprite(this.preloadBar)},create:function(){this.preloadBar.cropEnabled=!1,game.state.start("mainmenu")}},PreloaderS=a}(),function(){function a(){}a.prototype={create:function(){game.stage.backgroundColor="#333333",game.add.sprite(0,0,"frame"),this.enterKey=game.input.keyboard.addKey(Phaser.Keyboard.ENTER),this.enterKey.onDown.add(this.startGame,this),this.bttPlay=game.add.button(game.world.centerX,game.world.centerY+75,"btts",this.startGame,this,"play1","play0","play2"),this.bttAbout=game.add.button(game.world.centerX-75,game.world.centerY+75,"btts",this.credits,this,"about1","about0","about2"),this.text=game.add.text(game.world.centerX,game.world.centerY-40,"Rompecabezas",{font:"25px Source Code Pro",fill:"#f0f0f0",align:"center"}),this.textTut=game.add.text(game.world.centerX,game.world.centerY,"Usa las flechas para jugar",{font:"12px Source Code Pro",fill:"#f0f0f0",align:"center"}),this.text.anchor.setTo(.5,.5),this.textTut.anchor.setTo(.5,.5)},update:function(){},startGame:function(){game.state.start("play")},credits:function(){game.state.start("credits")}},MainMenuS=a}(),function(){function a(){}a.prototype={create:function(){game.add.sprite(0,0,"frame"),game.stage.backgroundColor="#333333";var a=0,b=0;b=localStorage.getItem("lastScore"),a=localStorage.getItem("highScore"),null===a&&(a=b,localStorage.setItem("highScore",b)),a>b&&localStorage.setItem("highScore",b),this.enterKey=game.input.keyboard.addKey(Phaser.Keyboard.ENTER),this.enterKey.onDown.add(this.startGame,this),this.bttPlay=game.add.button(game.world.centerX,game.world.centerY+75,"btts",this.startGame,this,"play1","play0","play2"),this.bttAbout=game.add.button(game.world.centerX-75,game.world.centerY+75,"btts",this.mainMenu,this,"about1","about0","about2"),this.text=game.add.text(game.world.centerX,game.world.centerY-20,"You Won!! \n High Score\n "+a+"\n Last Score\n "+b,{font:"17px Source Code Pro",fill:"#f0f0f0",align:"center"}),this.text.anchor.setTo(.5,.5)},update:function(){game.input.activePointer.justPressed()&&game.state.start("play")},startGame:function(){game.state.start("play")},mainMenu:function(){game.state.start("mainmenu")}},LeaderBoardsS=a}(),function(){function a(){}a.prototype={create:function(){game.add.sprite(0,0,"frame"),game.stage.backgroundColor="#333333",this.enterKey=game.input.keyboard.addKey(Phaser.Keyboard.ENTER),this.enterKey.onDown.add(this.startGame,this),this.bttPlay=game.add.button(game.world.centerX,game.world.centerY+75,"btts",this.startGame,this,"play1","play0","play2"),this.bttAbout=game.add.button(game.world.centerX-75,game.world.centerY+75,"btts",this.mainMenu,this,"about1","about0","about2"),this.text=game.add.text(game.world.centerX,game.world.centerY-20,"Rompecabezas\n Papitas\n",{font:"17px Source Code Pro",fill:"#f0f0f0",align:"center"}),this.text.anchor.setTo(.5,.5)},update:function(){game.input.activePointer.justPressed()&&game.state.start("play")},startGame:function(){game.state.start("play")},mainMenu:function(){game.state.start("mainmenu")}},CreditsS=a}(),function(){function a(){}a.prototype={create:function(){game.stage.backgroundColor="#FFF",game.add.sprite(0,0,"frame"),this.bttSolve=game.add.button(game.world.centerX-75,this.world.centerY+75,"btts",function(){this.quitGame("mainmenu")},this,"restart1","restart0","restart2"),this.bttPlay=game.add.button(game.world.centerX,this.world.centerY+75,"btts",this.shuffleBoard,this,"random1","random0","random2"),this.movesTxt=game.add.text(game.world.centerX,35,"Moves: ",{font:"25px Source Code Pro",fill:"#FFF",align:"center"}),this.movesTxt.anchor.setTo(.5,.5),this.upKey=game.input.keyboard.addKey(Phaser.Keyboard.UP),this.downKey=game.input.keyboard.addKey(Phaser.Keyboard.DOWN),this.leftKey=game.input.keyboard.addKey(Phaser.Keyboard.LEFT),this.rightKey=game.input.keyboard.addKey(Phaser.Keyboard.RIGHT),this.board=new Board,this.board.genRandom(),this.board.draw(),this.upKey.onDown.add(function(){this.board.move("up")},this),this.downKey.onDown.add(function(){this.board.move("down")},this),this.leftKey.onDown.add(function(){this.board.move("left")},this),this.rightKey.onDown.add(function(){this.board.move("right")},this)},update:function(){this.movesTxt.setText("Moves: "+this.board.moves),this.board.isFinal&&(localStorage.setItem("lastScore",this.board.moves),this.quitGame("leaderboards"))},quitGame:function(a){this.board.clearBoard(),this.board.destroy(),this.board=null,this.upKey.onDown.removeAll(),this.downKey.onDown.removeAll(),this.leftKey.onDown.removeAll(),this.rightKey.onDown.removeAll(),this.upKey=null,this.downKey=null,this.leftKey=null,this.rightKey=null,isMoving=!1,game.state.start(a)},shuffleBoard:function(){console.clear(),this.board.genRandom(),this.board.draw()},solveBoard:function(){var a=new Board;a.genFinal();var b=new Solver(this.board,a);b.solve()}},PlayS=a}();